---
title: "[译] Effective Modern CMake"
date: 2021-03-10T09:04:35+08:00
draft: true
tags:
  - 翻译练习
  - CMake
---

> 原文地址: [Effective Modern CMake](https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1)
> 原文作者: mbinna

## Getting Started (开始)

## General (综述)

### Use at least CMake version 3.0.0. (至少使用 CMake 3.0.0 版本)

### Treat CMake code like production code. (把 CMake 代码当做生产代码)

### Define project properties globally. (全局定义项目属性)

### Forget the commands `add_compile_options`, `include_directories`, `link_directories`, `link_libraries` (忘掉 `add_compile_options`, `include_directories`, `link_directories`, `link_libraries` 这些命令)

### Get your hands off `CMAKE_CXX_FLAGS`. (不要碰 `CMAKE_CXX_FLAGS`)

### Don’t abuse usage requirements. (不要滥用 requirements)

## Modules (模块)

### Use modern find modules that declare exported targets. (使用声明导出目标式的现代化 find 模块)

### Use exported targets of external packages. (使用外部包的导出目标)

### Use a find module for third-party libraries that do not support clients to use CMake. (对不支持用户使用 CMake 的第三方库使用 find 模块)

### Report it as a bug to third-party library authors if a library does not support clients to use CMake. If the library is an open-source project, consider sending a patch. (如果一个第三方库不支持用户使用 CMake, 就当成一个 bug 报告给库的作者. 如果这是一个开源的库, 考虑发送一个补丁)

### Write a find module for third-party libraries that do not support clients to use CMake. (为不支持用户使用 CMake 的第三方库写一个 find 模块)

### Export your library's interface, if you are a library author. (如果你是一个库的作者, 导出你的库的接口)

## Projects (项目)

### Avoid custom variables in the arguments of project commands. (避免在项目命令的参数里使用自定义变量)

### Don't use `file(GLOB)` in projects. (不要在项目里用 `file(GLOB)`)

### Put CI-specific settings in CTest scripts, not in the project. (把 CI-specific 放在 CTest 脚本中, 而不是在项目中)

## Targets and Properties (目标和属性)

### Think in terms of targets and properties. (考虑目标和属性)

### Imagine targets as objects. (把目标当成对象)

### Keep internal properties `PRIVATE`. (保持 `PRIVATE` 内部属性)

### Declare compile definitions with `target_compile_definitions`.

### Declare compile options with `target_compile_options`.

### Declare compile features with `target_compile_features`.

### Declare include directories with `target_include_directories`.

### Declare direct dependencies with `target_link_libraries`.

### Don't use `target_include_directories` with a path outside the component's directory.

### Always explicitly declare properties `PUBLIC`, `PRIVATE`, or `INTERFACE` when using `target_*`.

### Don't use `target_compile_options` to set options that affect the ABI.

### Using a library defined in the same CMake tree should look the same as using an external library.

## Functions and Macros (函数和宏)

### Prefer functions over macros whenever reasonable.

### Use macros for defining very small bits of functionality only or to wrap commands that have output parameters. Otherwise create a function.

### Don't use macros that affect all targets in a directory tree, like `include_directories`, `add_definitions`, or `link_libraries`.

## Arguments (参数)

### Use `cmake_parse_arguments` as the recommended way to handle complex argument-based behaviors or optional arguments in any function.

## Loops (循环)

### Use modern foreach syntax.

## Packages (包)

### Use CPack to create packages.

## Write a `CPackConfig.cmake` that includes the one generated by CMake. (写一个包含由 CMake 生成的 `CPackConfig.cmake`)

## Cross Compiling (交叉编译)

(TN: 个人理解更像是跨平台编译 Cross-platform Compiling)

### Use toolchain files for cross compiling.

### Keep toolchain files simple.

## Warnings and Errors (警告和错误)

### Treat build errors correctly.

### Treat warnings as errors.

### Treat new warnings as errors.

## Static Analysis (静态分析)

### Use more than one supported analyzer.

## For each header file, there must be an associated source file that `#include`s the header file at the top, even if that source file would otherwise be empty. (对每一个头文件来说, 必须有个关联的源文件在文件顶部引入该头文件, 即使那个源文件是空的)

## Sources (来源)
